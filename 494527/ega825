CREATE TABLE EGA.TBCMEANEXO (
  CMECODIGO smallint  not null ,
  CMASEQUENCIA bigint  not null ,
  CMATIPODOCUMENTO smallint  not null ,
  ARQID varchar(40) ,
  AQDSEQUENCIA bigint  not null ,
  AQDCOMPARTILHADO smallint DEFAULT 0 not null ,
  CONSTRAINT CHECK_CMATIPODOCUMENTO CHECK (CMATIPODOCUMENTO IN (6,5,4,3,2,1)),
  CONSTRAINT DOM3_AQDCOMPARTILHADO CHECK (AQDCOMPARTILHADO IN (0,1))
);
COMMENT ON TABLE EGA.TBCMEANEXO IS 'Anexos do Conselho Municipal de Educação';
COMMENT ON COLUMN EGA.TBCMEANEXO.CMECODIGO IS 'Código';
COMMENT ON COLUMN EGA.TBCMEANEXO.CMASEQUENCIA IS 'Sequência';
COMMENT ON COLUMN EGA.TBCMEANEXO.CMATIPODOCUMENTO IS 'Tipo de Documento';
COMMENT ON COLUMN EGA.TBCMEANEXO.ARQID IS 'Id do Arquivo';
COMMENT ON COLUMN EGA.TBCMEANEXO.AQDSEQUENCIA IS 'Sequência do Arquivo';
COMMENT ON COLUMN EGA.TBCMEANEXO.AQDCOMPARTILHADO IS 'Compartilhado?';

ALTER TABLE EGA.TBCMEANEXO ADD CONSTRAINT  PK_TBCMEANEXO PRIMARY KEY (CMECODIGO,CMASEQUENCIA) USING INDEX TABLESPACE INDICE;
CREATE UNIQUE INDEX idx_unique_cmeanexo_arqseq ON EGA.TBCMEANEXO(AQDSEQUENCIA)
 TABLESPACE INDICE 
 WHERE AQDCOMPARTILHADO = 0;

ALTER TABLE EGA.TBCMEANEXO ADD CONSTRAINT "FK TBCMEANEXO -> TBCONSELHOMUNICIPALEDU" FOREIGN KEY (CMECODIGO) REFERENCES EGA.TBCONSELHOMUNICIPALEDU (CMECODIGO) ;
ALTER TABLE EGA.TBCMEANEXO ADD CONSTRAINT "FK TBCMEANEXO -> TBARQUIVOFISICODETALHE" FOREIGN KEY (AQDSEQUENCIA,ARQID) REFERENCES WGD.TBARQUIVOFISICODETALHE (AQDSEQUENCIA,ARQID) 
 MATCH FULL DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE EGA.TBCMEANEXO ADD CONSTRAINT "FK TBCMEANEXO -> TBARQUIVODETALHE" FOREIGN KEY (AQDSEQUENCIA) REFERENCES WGD.TBARQUIVODETALHE (AQDSEQUENCIA) 
 MATCH FULL DEFERRABLE INITIALLY DEFERRED;
